<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ML Model Trainer</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h2>Machine Learning Model Trainer</h2>
    <form id="trainForm">
        <div>
            <label>Upload CSV File</label>
            <input type="file" name="file" required>
        </div>
        <div>
            <label>Target Column (optional)</label>
            <input type="text" name="target" placeholder="Leave empty for last column">
        </div>
        <div>
            <label>Choose Model</label>
            <select name="model" id="modelSelect" required>
                {% for m in models %}
                <option value="{{ m }}">{{ m.replace('_',' ').title() }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="params">
            <div id="logisticParams">
                <label>C (Logistic Regression)</label>
                <input type="number" step="any" name="C" value="1.0">
                <label>Penalty</label>
                <select name="penalty">
                    <option value="l2">l2</option>
                    <option value="l1">l1</option>
                </select>
                <label>Solver</label>
                <select name="solver">
                    <option value="lbfgs">lbfgs</option>
                    <option value="liblinear">liblinear</option>
                    <option value="saga">saga</option>
                </select>
            </div>
            <div id="svmParams">
                <label>C (SVM)</label>
                <input type="number" step="any" name="C" value="1.0">
                <label>Kernel</label>
                <select name="kernel">
                    <option value="rbf">rbf</option>
                    <option value="linear">linear</option>
                    <option value="poly">poly</option>
                    <option value="sigmoid">sigmoid</option>
                </select>
                <label>Gamma</label>
                <input type="text" name="gamma" value="scale">
            </div>
            <div id="rfParams">
                <label>Number of Estimators (Random Forest)</label>
                <input type="number" name="n_estimators" value="100">
                <label>Max Depth</label>
                <input type="number" name="max_depth">
            </div>
            <div id="knnParams">
                <label>Number of Neighbors (KNN)</label>
                <input type="number" name="n_neighbors" value="5">
                <label>Weights</label>
                <select name="weights">
                    <option value="uniform">uniform</option>
                    <option value="distance">distance</option>
                </select>
            </div>
            <div id="nbParams">
                <label>Var Smoothing (Naive Bayes)</label>
                <input type="number" step="any" name="var_smoothing" value="1e-9">
            </div>
        </div>

        <button type="submit">Train Model</button>
    </form>

    <div id="results"></div>
</div>

<script>
const modelSelect = document.getElementById('modelSelect');
const paramsDivs = {
    logistic: document.getElementById('logisticParams'),
    svm: document.getElementById('svmParams'),
    random_forest: document.getElementById('rfParams'),
    knn: document.getElementById('knnParams'),
    nb: document.getElementById('nbParams')
};

function showParams() {
    const model = modelSelect.value;
    for (const key in paramsDivs) {
        paramsDivs[key].style.display = (key === model) ? 'block' : 'none';
    }
}

showParams();
modelSelect.addEventListener('change', showParams);

document.getElementById('trainForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    formData.append('web','false');
    const res = await fetch('/train', { method: 'POST', body: formData });
    const data = await res.json();

    const resultsDiv = document.getElementById('results');
    if (data.error) {
        resultsDiv.innerHTML = `<p style="color:red;font-weight:bold;">${data.error}</p>`;
    } else {
        resultsDiv.innerHTML = `
            <h3>Results</h3>
            <p><strong>Model Used:</strong> ${data.model_used}</p>
            <p><strong>Target Column:</strong> ${data.used_target}</p>
            <p><strong>Features Used:</strong> ${data.features_used.join(', ')}</p>
            <p><strong>Accuracy:</strong> ${data.accuracy}</p>
            <p><strong>Precision:</strong> ${data.precision}</p>
            <p><strong>Recall:</strong> ${data.recall}</p>
            <p><strong>F1 Score:</strong> ${data.f1_score}</p>
            <h4>Confusion Matrix:</h4>
            <pre>${JSON.stringify(data.confusion_matrix,null,2)}</pre>
        `;
    }
});
</script>
</body>
</html>
